{% extends "base.html" %}
{% load upper from currency_filter %}
{% load breadcrumb from navigation %}
{% load vertical_menu from navigation %}
{% load vertical_filters from navigation %}

{% block breadcrumbs %}
  {% breadcrumb path=breadcrumbPath token=currentCategory %}
{% endblock %}

{% block content %}
  <div class="container">
    <div class="row">
      <div class="products-grid col-xl-9 col-lg-8 order-lg-2">
        <div class="row">

          {% for product in products %}
            <div class="col-xl-4 col-sm-6">
              <div class="product">
                <div class="product-image">
                  <img src="/media/{{ product.productimage__product_photo }}"
                       alt="product" class="img-fluid">
                  <div class="product-hover-overlay">
                    <a href="/product/{{ product.product_id }}" class="product-hover-overlay-link"></a>
                    <div class="product-hover-overlay-buttons">
                      <a href="#" class="btn btn-outline-dark btn-product-left"><i
                              class="fa fa-shopping-cart"></i>
                      </a>
                      <a href="/product/{{ product.product_id }}" class="btn btn-dark btn-buy"><i
                              class="fa-search fa"></i>
                        <span class="btn-buy-label ml-2">Перегляд</span>
                      </a>
                    </div>
                  </div>
                </div>
                <div class="py-2">
                  <p class="text-muted text-sm mb-1">{{ product.product_name }}</p>
                  <h3 class="h6 text-uppercase mb-1">
                    <a href="/product/{{ product.product_id }}" class="text-dark">{{ product.product_description }}</a>
                  </h3>
                  <span class="text-muted">{{ product.product_price }} {{ product.product_currency | upper }}.</span>
                </div>
              </div>
            </div>
          {% endfor %}

        </div>
        <nav aria-label="page navigation" class="d-flex justify-content-center mb-5 mt-3">
          <ul class="pagination">
            {#        TODO implement request.get_full_path#}
            {#        TODO move this block to the tag#}

            <li class="page-item">
              <a href="{% if products.has_previous %}?page={{ products.previous_page_number }}{% endif %}"
                 aria-label="Previous"
                 class="page-link  {% if not products.has_previous %}disabled{% endif %}">
                <span aria-hidden="true">Prev</span>
                <span class="sr-only">Previous</span>
              </a>
            </li>

            {% for page_number in page_range %}
              {% if products.number == page_number %}
                <li class="page-item active">
                  <a href="?page={{ page_number }}" class="page-link">{{ page_number }}</a>
                </li>
              {% else %}
                <li class="page-item">
                  <a href="?page={{ page_number }}" class="page-link">{{ page_number }}</a>
                </li>
              {% endif %}
            {% endfor %}

            <li class="page-item">
              <a href="{% if products.has_next %}?page={{ products.next_page_number }}{% endif %}" aria-label="Next"
                 class="page-link {% if not products.has_next %}disabled{% endif %}">
                <span aria-hidden="true">Next</span>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      {#    SIDEBAR  #}

      <div class="sidebar col-md-auto">

        {% vertical_menu items=verticalCategoriesTree current_category=currentCategory %}

        {% vertical_filters items=filters current_category=currentCategory %}

      </div>
    </div>
  </div>
{% endblock content %}
